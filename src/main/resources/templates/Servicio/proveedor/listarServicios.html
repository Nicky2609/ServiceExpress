<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Mis Servicios | ServiExpress</title>

    <!-- Font and Bootstrap -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <style>
        :root{
            /* Admin color palette */
            --bg:#F8EDE3;
            --tone-2:#DFD3C3;
            --tone-3:#D0B8A8;
            --brand:#C5705D;
            --brand-600:#a85848;
            --text:#3b2f2f;
            --surface:#ffffff;
            --ring:rgba(197,112,93,.35);
            --line:#e6d7ce;
            --ok:#1f9d65;
            --ok-bg:#e9f8ef;
            --warn:#8b5e00;
            --warn-bg:#fff7e8;
            --off:#7a6f68;
            --off-bg:#f1eeec;
        }

        *{box-sizing:border-box;}
        body{
            /* General body styles */
            font-family:Poppins, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
            background:var(--bg);
            color:var(--text);
            margin:0;
        }

        /* NAVBAR STYLES */
        .se-nav{
            position:sticky; top:0; z-index:50;
            background:linear-gradient(90deg,var(--bg),var(--tone-2));
            border-bottom:1px solid var(--line);
            backdrop-filter:saturate(1.1) blur(4px);
        }
        .se-brand{
            /* Brand name style */
            font-weight:800; letter-spacing:.2px; color:var(--brand-600)!important; text-decoration:none; font-size:20px;
        }
        .se-chip{
            /* Chip-style buttons */
            background:var(--surface); border:1px solid var(--tone-2); border-radius:999px;
            padding:.55rem .95rem; box-shadow:0 6px 16px rgba(0,0,0,.06); font-weight:700;
        }
        .btn-brand{ background:var(--brand); border-color:var(--brand); color:#fff; }
        .btn-brand:hover{ filter:brightness(.96); color:#fff; }
        .btn-ghost{ background:var(--surface); border:1px solid var(--tone-2); color:var(--text); }
        .form-control:focus{ border-color:var(--brand)!important; box-shadow:0 0 0 .25rem var(--ring)!important; }

        /* CONTAINER / CARD STYLES */
        .se-card{
            background:var(--surface); border:1px solid var(--tone-2);
            border-radius:18px; padding:1.5rem; box-shadow:0 10px 28px rgba(0,0,0,.06);
        }

        /* TITLE STYLES */
        h1{
            font-weight:800;
            color:var(--brand-600);
            text-align:center;
        }
        .subtle{
            text-align:center;
            color:#7c6a63;
            margin-bottom:1.5rem;
        }

        /* SEARCH BOX STYLES */
        .search-box{
            display:flex; align-items:center; gap:.5rem;
            background:var(--surface);
            border:1px solid var(--tone-2);
            border-radius:999px;
            padding:.6rem 1rem;
            box-shadow:0 6px 16px rgba(0,0,0,.06);
            max-width:380px;
            margin:0 auto 1.5rem;
        }
        .search-box input{
            border:none; outline:none;
            flex:1; background:none;
            font-family:inherit; color:var(--text);
        }

        /* TABLE STYLES */
        .table thead th{
            background:var(--tone-2)!important;
            color:#5a493f;
            border-bottom-color:var(--tone-2)!important;
            font-weight:800;
        }
        .table-striped>tbody>tr:nth-of-type(odd){
            --bs-table-accent-bg: rgba(208,184,168,.12);
        }
        .table-hover tbody tr:hover{
            background-color:rgba(208,184,168,.18)!important;
        }
        th, td{
            vertical-align:middle;
        }

        /* STATUS PILLS STYLES */
        .pill{
            display:inline-flex; align-items:center; gap:8px;
            padding:6px 10px;
            border-radius:999px;
            font-weight:800;
            border:1px solid var(--line);
            background:#faf7f5;
            color:var(--text);
        }
        .pill[data-state="DISPONIBLE"]{ background:var(--ok-bg); color:var(--ok); border-color:#cfeedd; }
        .pill[data-state="OCUPADO"], .pill[data-state="NO_DISPONIBLE"]{ background:var(--warn-bg); color:var(--warn); border-color:#ffe0b3; }
        .pill[data-state="INACTIVO"]{ background:var(--off-bg); color:var(--off); }

        /* BUTTON STYLES */
        .btn{
            border-radius:30px;
            font-weight:600;
        }
        .btn-secondary{
            background:var(--tone-3);
            color:#fff;
            border:none;
        }
        .btn-secondary:hover{
            background:var(--brand);
        }
        .btn-danger{
            background:#c94d3f;
            color:#fff;
            border:none;
        }
        .btn-danger:hover{
            background:#a53a30;
        }

        /* MODAL STYLES */
        .modal-overlay{
            position:fixed; inset:0;
            display:none; place-items:center;
            background:rgba(0,0,0,.45);
        }
        .modal-overlay.open{ display:grid; }
        .modal{
            width:min(420px,92vw);
            background:var(--surface);
            border:1px solid var(--tone-2);
            border-radius:18px;
            padding:1.5rem;
            box-shadow:0 24px 50px rgba(0,0,0,.18);
            animation:pop .16s ease-out forwards;
        }
        @keyframes pop{ from{transform:translateY(10px);opacity:0;} to{transform:translateY(0);opacity:1;} }
        .modal h2{ margin:0 0 10px; font-size:20px; color:var(--brand-600); text-align:center; }
        .modal-actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:14px; }
    </style>
</head>
<body>

<!-- Main navigation bar -->
<nav class="se-nav py-3">
    <div class="container d-flex align-items-center justify-content-between gap-3">
        <a class="se-brand" th:href="@{/}">ServiExpress</a>
        <div class="d-flex align-items-center gap-2">
            <a th:href="@{/}" class="btn btn-ghost se-chip">Inicio</a>
            <a th:href="@{/solicitud/proveedor/listar}" class="btn btn-brand se-chip">Ver Historial</a>
            <!-- Logout form -->
            <form th:action="@{/auth/logout}" method="post" class="m-0 p-0">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button class="btn btn-outline-danger se-chip" type="submit">Cerrar sesión</button>
            </form>
        </div>
    </div>
</nav>

<!-- Main content -->
<main class="container my-5">
    <div class="se-card mb-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
            <div>
                <h1>Mis Servicios</h1>
                <p class="subtle">Gestiona y edita tus servicios publicados.</p>
            </div>
            <!-- Link to create a new service -->
            <a class="btn btn-brand" th:href="@{/servicio/crearServicio}">+ Crear servicio</a>
        </div>

        <!-- Search bar -->
        <div class="search-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                 fill="none" stroke="#C5705D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.3-4.3"/>
            </svg>
            <input type="search" id="buscar" placeholder="Buscar por nombre, descripción o estado…">
        </div>

        <!-- Services table -->
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Precio</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody id="tablaServicios">
                <!-- Iterate over services -->
                <tr th:each="servicio : ${servicios}">
                    <td th:text="${servicio.nombre}">—</td>
                    <td th:text="${servicio.descripcion}">—</td>
                    <td>$<span th:text="${servicio.precio}">0</span></td>
                    <td>
                        <span class="pill" th:attr="data-state=${servicio.estado}" th:text="${servicio.estado}">DISPONIBLE</span>
                    </td>
                    <td>
                        <div class="d-flex gap-2 flex-wrap">
                            <!-- Edit service link -->
                            <a th:href="@{/servicio/editar/{id}(id=${servicio.idServicio})}" class="btn btn-secondary btn-sm">Editar</a>
                            <!-- Delete service button -->
                            <button type="button" class="btn btn-danger btn-sm" th:attr="data-id=${servicio.idServicio}" onclick="abrirModal(this)">Eliminar</button>
                        </div>
                    </td>
                </tr>
                <!-- Empty state row -->
                <tr th:if="${#lists.isEmpty(servicios)}">
                    <td colspan="5" class="text-center text-muted">No tienes servicios registrados.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</main>

<!-- Delete confirmation modal -->
<div id="modalEliminar" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <h2 id="modalTitle">¿Eliminar este servicio?</h2>
        <p class="subtle text-center">Esta acción no se puede deshacer.</p>
        <form id="formEliminar" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
                <button type="submit" class="btn btn-danger">Eliminar</button>
            </div>
        </form>
    </div>
</div>

<!-- Main script -->
<script>
    const modal = document.getElementById("modalEliminar");
    const formEliminar = document.getElementById("formEliminar");

    /**
     * Opens the delete modal and sets the form action dynamically.
     * @param btn HTML button element that triggered the event
     */
    function abrirModal(btn){
        const idServicio = btn.getAttribute("data-id");
        formEliminar.setAttribute("action","/servicio/eliminar/"+idServicio);
        modal.classList.add("open");
        modal.setAttribute("aria-hidden","false");
    }

    /**
     * Closes the delete modal.
     */
    function cerrarModal(){
        modal.classList.remove("open");
        modal.setAttribute("aria-hidden","true");
    }

    /**
     * Closes modal when clicking outside of it.
     */
    modal.addEventListener("click", e => { if(e.target===modal) cerrarModal(); });

    /**
     * Closes modal with Escape key.
     */
    document.addEventListener("keydown", e => { if(e.key==="Escape") cerrarModal(); });

    /**
     * Filters services table rows based on user input.
     */
    const inputBuscar = document.getElementById("buscar");
    inputBuscar.addEventListener("input", function(){
        const filtro = (this.value || "").toLowerCase();
        const filas = document.querySelectorAll("#tablaServicios tr");
        filas.forEach(fila => {
            // Skip empty state row
            if(fila.querySelector("td[colspan]")) return;
            const texto = fila.textContent.toLowerCase();
            fila.style.display = texto.includes(filtro) ? "" : "none";
        });
    });
</script>

</body>
</html>

<!-- Summary (Technical Note):
This HTML file is a Thymeleaf template for the "My Services" page in the ServiExpress application.
It displays a list of services provided by the logged-in user in a searchable table.
Users can create, edit, or delete services. The delete action opens a modal confirmation dialog.
Client-side JavaScript handles modal interactions and dynamic search filtering.
Styling uses Bootstrap and custom CSS variables for a consistent admin theme.
-->
