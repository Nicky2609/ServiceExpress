<!-- ===================================================== -->
<!-- Página de servicios disponibles / Available Services Page -->
<!-- ===================================================== -->
<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <!-- Codificación de caracteres / Character encoding -->
    <meta charset="UTF-8">

    <!-- Título dinámico de la página / Dynamic page title -->
    <title th:text="${title} ?: 'Servicios Disponibles'">Servicios Disponibles</title>

    <!-- Fuente Poppins desde Google Fonts / Poppins font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS para estilos base / Bootstrap CSS for base styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <style>
        /* ===================================================== */
        /* Paleta de colores y variables / Color palette and variables */
        /* ===================================================== */
        :root{
            --bg:#F8EDE3; --tone-2:#DFD3C3; --tone-3:#D0B8A8; --brand:#C5705D;
            --brand-600:#a85848; --text:#3b2f2f; --surface:#ffffff; --ring:rgba(197,112,93,.35);
            --line:#e6d7ce;
        }

        /* Configuración básica / Basic setup */
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            background:var(--bg);
            color:var(--text);
            font-family:Poppins, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
        }

        /* ===== NAVBAR ===== */
        /* Barra superior de navegación / Top navigation bar */
        .se-nav{
            position:sticky; top:0; z-index:50;
            background:linear-gradient(90deg,var(--bg),var(--tone-2));
            border-bottom:1px solid var(--line);
            backdrop-filter:saturate(1.1) blur(4px);
        }

        /* Estilo de la marca ServiExpress / ServiExpress brand style */
        .se-brand{
            font-weight:800; letter-spacing:.2px; color:var(--brand-600)!important; text-decoration:none; font-size:20px;
        }

        /* Estilo para chips o botones redondeados / Style for pill-shaped buttons */
        .se-chip{
            background:var(--surface); border:1px solid var(--tone-2); border-radius:999px;
            padding:.55rem .95rem; box-shadow:0 6px 16px rgba(0,0,0,.06); font-weight:700;
        }

        /* Botón principal con color de marca / Primary button with brand color */
        .btn-brand{ background:var(--brand); border-color:var(--brand); color:#fff; }
        .btn-brand:hover{ filter:brightness(.96); color:#fff; }

        /* Botón transparente con borde / Transparent outlined button */
        .btn-ghost{ background:var(--surface); border:1px solid var(--tone-2); color:var(--text); }

        /* Efecto de foco en campos / Focus effect on inputs */
        .form-control:focus{ border-color:var(--brand)!important; box-shadow:0 0 0 .25rem var(--ring)!important; }

        /* ===== CARD ===== */
        /* Tarjetas o contenedores visuales / Cards or visual containers */
        .se-card{
            background:var(--surface); border:1px solid var(--tone-2);
            border-radius:18px; padding:1.25rem; box-shadow:0 10px 28px rgba(0,0,0,.06);
        }

        /* ===== TABLA ===== */
        /* Cabecera de tabla estilizada / Styled table header */
        .table thead th{
            background:var(--tone-2)!important; color:#5a493f; border-bottom-color:var(--tone-2)!important; font-weight:800;
        }

        /* Filas alternas con color suave / Alternating row color */
        .table-striped>tbody>tr:nth-of-type(odd){ --bs-table-accent-bg: rgba(208,184,168,.12); }

        /* Espaciado entre botones de acción / Gap between action buttons */
        .actions-gap{gap:.4rem}
    </style>
</head>

<body>

<!-- ===== NAV ===== -->
<!-- Barra de navegación principal / Main navigation bar -->
<nav class="se-nav py-3" role="navigation" aria-label="Principal">
    <div class="container d-flex align-items-center justify-content-between gap-3">
        <!-- Nombre de la marca / Brand name -->
        <a class="se-brand" th:href="@{/}">ServiExpress</a>

        <!-- Enlaces del menú / Menu links -->
        <div class="d-flex align-items-center actions-gap">
            <a th:href="@{/}" class="btn btn-ghost se-chip">Inicio</a>
            <a th:href="@{/servicio}" class="btn btn-ghost se-chip">Servicios</a>
            <a th:href="@{/auth/registro}" class="btn btn-brand se-chip">Registro</a>
        </div>
    </div>
</nav>

<!-- ===== CONTENIDO PRINCIPAL ===== -->
<!-- Sección principal de la página / Main page section -->
<main class="container my-4">

    <!-- Encabezado con buscador / Header with search bar -->
    <div class="d-flex align-items-end justify-content-between mb-3">
        <h1 class="m-0 fw-bold">Servicios Disponibles</h1>

        <!-- Campo de búsqueda / Search field -->
        <form class="d-flex" role="search" onsubmit="return false">
            <input id="buscar" type="search" class="form-control se-chip"
                   placeholder="Buscar servicio…" autocomplete="off">
        </form>
    </div>

    <!-- Mensajes informativos / Informational messages -->
    <div class="se-card mb-3">
        <div th:if="${success}" class="alert alert-success mb-2" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger mb-0" th:text="${error}"></div>
        <div th:if="${success == null and error == null}" class="small text-muted">
            Tip: usa el buscador para encontrar servicios fácilmente. / Tip: use the search bar to find services easily.
        </div>
    </div>

    <!-- Botón para crear nuevo servicio (solo admin/proveedor) / Create service button (admin/provider only) -->
    <div class="mb-3" sec:authorize="hasAnyRole('ADMIN','PROVEEDOR')">
        <a class="btn btn-brand se-chip" th:href="@{/servicio/crearServicio}">+ Crear Nuevo Servicio</a>
    </div>

    <!-- Tabla de servicios / Services table -->
    <div class="se-card">
        <div class="table-responsive">
            <table class="table table-striped align-middle mb-0" id="tablaServicios">
                <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Precio</th>
                    <th>Proveedor</th>
                    <th>Estado</th>
                    <th class="text-end">Acciones</th>
                </tr>
                </thead>
                <tbody>
                <!-- Iteración sobre la lista de servicios / Iterating over services list -->
                <tr th:each="servicio : ${servicios}">
                    <td th:text="${servicio.nombre}">Nombre</td>
                    <td th:text="${servicio.descripcion}">Descripción</td>
                    <td th:text="${servicio.precio}">0.00</td>
                    <td th:text="${servicio.proveedor != null ? servicio.proveedor.nombreUsuario : 'Sin asignar'}"></td>
                    <td th:text="${servicio.estado}"></td>
                    <td class="text-end">
                        <!-- Acciones para ADMIN / Actions for ADMIN -->
                        <div sec:authorize="hasRole('ADMIN')">
                            <a th:href="@{/servicio/editar/{id}(id=${servicio.idServicio})}" class="btn btn-warning btn-sm">Editar</a>
                            <button type="button" class="btn btn-danger btn-sm js-delete"
                                    th:data-id="${servicio.idServicio}">Eliminar</button>
                        </div>

                        <!-- Acciones para el proveedor propietario / Actions for the owning provider -->
                        <div th:if="${rol == 'PROVEEDOR' and servicio.proveedor != null && servicio.proveedor.idUsuario == usuarioSesion.idUsuario}">
                            <a th:href="@{/servicio/editar/{id}(id=${servicio.idServicio})}" class="btn btn-warning btn-sm">Editar</a>
                            <button type="button" class="btn btn-danger btn-sm js-delete"
                                    th:data-id="${servicio.idServicio}">Eliminar</button>
                        </div>

                        <!-- Acciones para CLIENTE / Actions for CLIENT -->
                        <div sec:authorize="hasRole('CLIENTE')">
                            <a th:href="@{/solicitud/crear/{id}(id=${servicio.idServicio})}" class="btn btn-brand btn-sm">Solicitar</a>
                        </div>
                    </td>
                </tr>

                <!-- Mensaje si no hay servicios / Message when there are no services -->
                <tr th:if="${#lists.isEmpty(servicios)}">
                    <td colspan="6" class="text-center text-muted">No se encontraron servicios / No services found</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</main>

<!-- ===== MODAL DE CONFIRMACIÓN ===== -->
<!-- Modal para confirmar eliminación / Modal to confirm deletion -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0" style="border-radius:16px; overflow:hidden;">
            <!-- Encabezado del modal / Modal header -->
            <div class="modal-header border-0" style="background:#DFD3C3;">
                <h5 id="confirmDeleteTitle" class="modal-title" style="color:#3b2f2f; font-weight:700;">¿Eliminar servicio?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <!-- Cuerpo del modal / Modal body -->
            <div class="modal-body" style="background:#F8EDE3; color:#3b2f2f;">
                <p class="mb-0">Esta acción no se puede deshacer. ¿Deseas continuar? / This action cannot be undone. Do you want to continue?</p>
            </div>

            <!-- Pie del modal / Modal footer -->
            <div class="modal-footer border-0" style="background:#F8EDE3;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar / Cancel</button>
                <form id="confirmDeleteForm" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" class="btn btn-brand text-white">Sí, eliminar / Yes, delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ===== SCRIPTS ===== -->
<!-- Bootstrap JS / Bootstrap JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Script para buscador y modal / Script for search and modal -->
<script>
    (function(){
        // Modal de confirmación / Confirmation modal
        const modalEl = document.getElementById('confirmDeleteModal');
        const form = document.getElementById('confirmDeleteForm');
        if(modalEl && form){
            const modal = new bootstrap.Modal(modalEl);
            document.querySelectorAll('.js-delete').forEach(btn => {
                btn.addEventListener('click', () => {
                    form.setAttribute('action', '/servicio/eliminar/' + btn.getAttribute('data-id'));
                    modal.show();
                });
            });
        }

        // Filtro de búsqueda / Search filter
        const input = document.getElementById('buscar');
        const table = document.getElementById('tablaServicios');
        if(!input || !table) return;
        const rows = table.querySelectorAll('tbody tr');
        input.addEventListener('input', e => {
            const q = e.target.value.toLowerCase();
            let any = false;
            rows.forEach(r => {
                if(r.querySelectorAll('td').length){
                    const t = r.textContent.toLowerCase();
                    const match = t.includes(q);
                    r.style.display = match ? '' : 'none';
                    if(match) any = true;
                }
            });
        });
    })();
</script>

</body>
</html>

<!-- ===================================================== -->
<!-- Resumen técnico / Technical Summary:
- Este HTML muestra la lista de servicios disponibles con filtrado en tiempo real.
- Integra Thymeleaf para mostrar dinámicamente los servicios desde el servidor.
- Botones de acción varían según el rol del usuario (ADMIN, PROVEEDOR, CLIENTE).
- Modal de confirmación para eliminar servicios.
- CSRF token incluido para seguridad con Spring Security.
- Uso de Bootstrap y estilos personalizados para diseño moderno y responsivo.
-->
