<!doctype html>
<!-- Registration page template -->
<!-- Purpose: Provides a user interface for new users to create an account. -->
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <!-- UTF-8 character encoding for internationalization -->

    <title>Crear cuenta</title>
    <!-- Page title shown in the browser tab -->

    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <!-- External CSS for global styles -->

    <style>
        /* ===================== CSS VARIABLES ===================== */
        /* Define main colors and layout constants for registration page */
        :root {
            --bg:#f6ece3;      /* Background color for page / page background */
            --card:#fff;        /* Card container background / card container */
            --stroke:#ead8ce;   /* Card border / card border */
            --text:#2b2b2b;     /* Default text color / text color */
            --muted:#9a7d72;    /* Secondary text color / muted info */
            --brand:#c77462;    /* Primary action color / brand color */
        }

        /* ===================== GLOBAL STYLES ===================== */
        *{box-sizing:border-box}
        body{
            min-height:100vh;
            margin:0;
            display:grid;
            place-items:center; /* Center card vertically and horizontally */
            background:var(--bg);
            font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
            color:var(--text);
        }

        /* ===================== CARD ===================== */
        .card{
            width:min(560px,94vw); /* Responsive max-width */
            background:var(--card);
            border:1px solid var(--stroke);
            border-radius:16px;
            box-shadow:0 12px 28px rgba(0,0,0,.06); /* Subtle shadow for elevation */
        }
        .body{padding:28px}
        h1{margin:0 0 10px}

        /* ===================== FORM GROUPS ===================== */
        .group{margin:14px 0}
        label{font-weight:600;display:block;margin:0 0 6px}
        input{
            width:100%;
            padding:12px 14px;
            border:1px solid #dec6bb;
            border-radius:12px;
            font-size:1rem;
        }

        /* ===================== ROWS & BUTTONS ===================== */
        .row{display:flex;gap:12px;margin-top:14px}
        .row.two > *{flex:1} /* Two-column layout for phone and city fields */
        .btn{
            border-radius:12px;
            padding:12px 16px;
            font-weight:700;
            border:1px solid var(--brand);
            cursor:pointer;
        }
        .btn.primary{background:var(--brand);color:#fff} /* Submit / primary action */
        .btn.ghost{background:transparent;color:var(--brand)} /* Secondary action */

        /* ===================== ERROR MESSAGES ===================== */
        .error{color:#8b1a1a;font-size:.9rem;margin-top:6px} /* Field-level errors */
        .alert{padding:12px 14px;border-radius:12px;margin:10px 0;background:#fde8e8;border:1px solid #f4b4b4;color:#8b1a1a}
        /* Global form errors / summary */

        /* ===================== PASSWORD TOGGLE ===================== */
        .pw-toggle{position:absolute;right:12px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:.9rem;color:var(--muted)}
        .pw-wrap{position:relative} /* Wrap input for toggle functionality */
    </style>
</head>
<body>
<div class="card">
    <div class="body">
        <h1>Crear cuenta</h1>
        <p style="color:var(--muted);margin-top:0">Regístrate para empezar a usar ServiExpress.</p>
        <!-- Subtitle / instruction for new users -->

        <!-- ===================== GLOBAL FORM ERRORS ===================== -->
        <div class="alert" th:if="${#fields.hasGlobalErrors()}"
             th:each="e : ${#fields.globalErrors()}" th:text="${e}">Hay errores en el formulario.</div>
        <!-- Displays global validation errors for the form -->

        <!-- ===================== REGISTRATION FORM ===================== -->
        <form th:action="@{/auth/registro}" th:object="${form}" method="post" novalidate>
            <!-- Name field -->
            <div class="group">
                <label for="nombreUsuario">Nombre</label>
                <input id="nombreUsuario" th:field="*{nombreUsuario}" placeholder="Tu nombre"
                       maxlength="80" autocomplete="name" required>
                <div class="error" th:if="${#fields.hasErrors('nombreUsuario')}" th:errors="*{nombreUsuario}"></div>
            </div>

            <!-- Email field -->
            <div class="group">
                <label for="correo">Correo</label>
                <input id="correo" type="email" th:field="*{correo}" placeholder="tucorreo@dominio.com"
                       maxlength="120" autocomplete="email" required>
                <div class="error" th:if="${#fields.hasErrors('correo')}" th:errors="*{correo}"></div>
            </div>

            <!-- Phone and City fields (two-column layout) -->
            <div class="row two">
                <div class="group">
                    <label for="telefono">Teléfono</label>
                    <input id="telefono" th:field="*{telefono}" placeholder="300 123 4567"
                           inputmode="tel" autocomplete="tel" required>
                    <div class="error" th:if="${#fields.hasErrors('telefono')}" th:errors="*{telefono}"></div>
                </div>

                <div class="group">
                    <label for="ciudad">Ciudad</label>
                    <input id="ciudad" th:field="*{ciudad}" placeholder="Tu ciudad"
                           maxlength="100" autocomplete="address-level2" required>
                    <div class="error" th:if="${#fields.hasErrors('ciudad')}" th:errors="*{ciudad}"></div>
                </div>
            </div>

            <!-- Password field -->
            <div class="group">
                <label for="password">Contraseña</label>
                <div class="pw-wrap">
                    <input id="password" type="password" th:field="*{password}" minlength="6" maxlength="120"
                           autocomplete="new-password" required>
                    <span class="pw-toggle" data-target="password">mostrar</span>
                    <!-- Toggle visibility of password field -->
                </div>
                <div class="error" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
            </div>

            <!-- Confirm Password field -->
            <div class="group">
                <label for="confirmarPassword">Confirmar contraseña</label>
                <div class="pw-wrap">
                    <input id="confirmarPassword" type="password" th:field="*{confirmarPassword}" minlength="6" maxlength="120"
                           autocomplete="new-password" required>
                    <span class="pw-toggle" data-target="confirmarPassword">mostrar</span>
                </div>
                <div class="error" th:if="${#fields.hasErrors('confirmarPassword')}" th:errors="*{confirmarPassword}"></div>
            </div>

            <!-- CSRF token -->
            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <!-- Form action buttons -->
            <div class="row">
                <a class="btn ghost" th:href="@{/auth/login}">Ya tengo cuenta</a>
                <!-- Redirect to login page -->
                <button class="btn primary" type="submit">Crear cuenta</button>
                <!-- Submit registration form -->
            </div>
        </form>
    </div>
</div>

<!-- ===================== PASSWORD TOGGLE SCRIPT ===================== -->
<script>
    /* Toggle password visibility for password and confirm password fields */
    document.querySelectorAll('.pw-toggle').forEach(t => {
        t.addEventListener('click', () => {
            const id = t.getAttribute('data-target');
            const input = document.getElementById(id);
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            t.textContent = type === 'password' ? 'mostrar' : 'ocultar';
        });
    });
</script>
</body>
</html>

<!-- Summary (Technical Note):
This HTML file defines the user registration page for ServiExpress. It provides a card-based responsive layout where new users can input their name, email, phone, city, and password. Validation errors are displayed both at the field level and globally. Password fields include toggle visibility functionality. CSRF protection is integrated via hidden input. The form submits to the Spring Security registration endpoint `@{/auth/registro}`. -->
